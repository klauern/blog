<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>2015s on A Turn of Phrase</title>
    <link>http://localhost:1313/2015/</link>
    <description>Recent content in 2015s on A Turn of Phrase</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 15 Oct 2015 20:02:18 -0500</lastBuildDate>
    <atom:link href="http://localhost:1313/2015/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>keystores and certificate expiration</title>
      <link>http://localhost:1313/2015/keystores-and-certificate-expiration/</link>
      <pubDate>Thu, 15 Oct 2015 20:02:18 -0500</pubDate>
      
      <guid>http://localhost:1313/2015/keystores-and-certificate-expiration/</guid>
      <description>

&lt;p&gt;I&amp;rsquo;ve seldom had to work with the Java Keystore, but as more and more sites start
using SSL, it&amp;rsquo;s grown more important to ensure that certificates stored on your
side don&amp;rsquo;t arbitrarily expire.  This is especially important if you&amp;rsquo;re not
simply relying or verifying intermediate and root certificates.  A self-signed
server certificate is oftentimes &lt;em&gt;easy enough&lt;/em&gt; to do for some applications, and
that expiration can come quicker than you anticipate.&lt;/p&gt;

&lt;p&gt;In this section, I&amp;rsquo;ll demonstrate a little bit about how you can get at the
certificate store within the relatively standard JKS-format of the Java
Cryptography Keystore.  Other stores may not work this way, or may require
a different set of processes.&lt;/p&gt;

&lt;p&gt;Side Note: I have to give credit where credit is due, and &lt;a href=&#34;http://stackoverflow.com/a/10986535/7008&#34;&gt;this StackOverflow
answer&lt;/a&gt;
provided a great starting point for getting things going.  It was essentially
the foundation for what you&amp;rsquo;ll see in this post.&lt;/p&gt;

&lt;h1 id=&#34;parsing-the-keystore:ea83c6f13264b77e32b6387eb48f3ca8&#34;&gt;Parsing the Keystore&lt;/h1&gt;

&lt;p&gt;To make this easy, I generally use the following libraries in most of my
projects:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/google/guava&#34;&gt;Google Guava&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.joda.org/joda-time/&#34;&gt;Joda Time&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;Of course, if you&amp;rsquo;re lucky enough to use Java 8, we&amp;rsquo;d be using
&lt;a href=&#34;http://www.oracle.com/technetwork/articles/java/jf14-date-time-2125367.html&#34;&gt;Java 8&amp;rsquo;s Date and Time&lt;/a&gt;
library.  But, for a vast majority of users, we&amp;rsquo;re stuck with 7 or less.
Ah, c&amp;rsquo;est la vie.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Reading the Keystore is actually a pretty straight-forward process:&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #202020&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// import a ton of stuff&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;com.google.common.collect.Lists&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;com.google.common.collect.Maps&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;org.joda.time.DateTime&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;org.joda.time.Days&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.io.FileInputStream&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.io.IOException&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.KeyStore&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.KeyStoreException&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.NoSuchAlgorithmException&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.UnrecoverableEntryException&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.cert.Certificate&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.cert.CertificateException&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.security.cert.X509Certificate&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color: #447fcf; text-decoration: underline&#34;&gt;java.util.*&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// ... more code, some method somewhere&lt;/span&gt;

&lt;span style=&#34;color: #d0d0d0&#34;&gt;KeyStore&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;KeyStore.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getInstance&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(KeyStore.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getDefaultType&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;());&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;char&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;pass&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #ed9d13&#34;&gt;&amp;quot;changeit&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// or whatever&lt;/span&gt;

&lt;span style=&#34;color: #d0d0d0&#34;&gt;java.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;io&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;InputStream&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;fis&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;try&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;fis&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Reader.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;class&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getClassLoader&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getResourceAsStream&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(file_path);&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;load&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(fis,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;pass);&lt;/span&gt;

    &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// Get Certificate listing&lt;/span&gt;

&lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;finally&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(fis&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;fis.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;close&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1 id=&#34;traversing-certificates-and-aliases:ea83c6f13264b77e32b6387eb48f3ca8&#34;&gt;Traversing Certificates and Aliases&lt;/h1&gt;

&lt;p&gt;From this point, we&amp;rsquo;re able to read in and claim &lt;strong&gt;success&lt;/strong&gt;! Nah, not really.
What do you want to do with this?  Well, in this case, our KeyStore will have
a lot of various certificates and trusts in it.  For our use, we simply want to
validate the ones that are going to expire.&lt;/p&gt;

&lt;p&gt;With each certificate that we have, there are likely 1 or more other
certificates in a &lt;a href=&#34;https://support.dnsimple.com/articles/what-is-ssl-certificate-chain/&#34;&gt;&lt;strong&gt;certificate chain&lt;/strong&gt;&lt;/a&gt;.
We aren&amp;rsquo;t simply going to find expired server certificates (although that&amp;rsquo;s
laudable in and of itself), but we want to be sure we aren&amp;rsquo;t going to suffer the
fate of thinking &amp;ldquo;well, our server cert passed, but this whole tree of servers&amp;rsquo;
intermediate certificates expired&amp;rdquo;.&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #202020&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Map&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #447fcf&#34;&gt;getCertMap&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(KeyStore&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks)&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;throws&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;KeyStoreException&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;Map&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Maps.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newHashMap&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt; &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// Good &amp;#39;ol Guava&lt;/span&gt;
    &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// Each KeyStore can return an &amp;quot;Enumeration&amp;quot; of aliases&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;Enumeration&amp;lt;String&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;aliases&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;aliases&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;while&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(aliases.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;hasMoreElements&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;())&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;String&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;alias&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;aliases.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;nextElement&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;Certificate[]&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getCertificateChain&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(alias);&lt;/span&gt;
        &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// It&amp;#39;s not a guarantee that you&amp;#39;ll have ANY certificates&lt;/span&gt;
        &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(certs&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;length&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #3677a9&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;put&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(alias,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Lists.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newArrayList&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(certs));&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;else&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;Certificate&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;ks.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getCertificate&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(alias);&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;put&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(alias,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Lists.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newArrayList&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(cert));&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map;&lt;/span&gt;
&lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1 id=&#34;filtering:ea83c6f13264b77e32b6387eb48f3ca8&#34;&gt;Filtering&lt;/h1&gt;

&lt;p&gt;Another assumption being made here is that if you have a certificate that&amp;rsquo;s
going to expire, it&amp;rsquo;s most likely an &lt;strong&gt;X.509&lt;/strong&gt; certificate, and so we only need
to be concerned with a subset of certificates.&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #202020&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Map&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;X509Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #447fcf&#34;&gt;filterX509Certs&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(Map&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;Map&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;X509Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;x509_map&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Maps.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newHashMap&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
        &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(Map.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;Entry&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;&amp;lt;String,&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;Certificate&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert_map.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;entrySet&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;())&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;X509Certificate&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Lists.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newArrayListWithCapacity&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(c.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getValue&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;size&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;());&lt;/span&gt;
            &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(Certificate&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;c.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getValue&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;())&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
                &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// This is where the magic happens...&lt;/span&gt;
                &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(cert.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getType&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;equals&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ed9d13&#34;&gt;&amp;quot;X.509&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
                    &lt;span style=&#34;color: #999999; font-style: italic&#34;&gt;// cast the type to X509Certificate&lt;/span&gt;
                    &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;add&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;((X509Certificate)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert);&lt;/span&gt;
                &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;x509_map.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;put&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(c.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getKey&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(),&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs);&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
        &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;x509_map;&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It took a lot longer to figure out that this one little line&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #202020&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;                &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(cert.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getType&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;().&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;equals&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ed9d13&#34;&gt;&amp;quot;X.509&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;))&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;is where you figure out the type.&lt;/p&gt;

&lt;h1 id=&#34;finding-by-date:ea83c6f13264b77e32b6387eb48f3ca8&#34;&gt;Finding by Date&lt;/h1&gt;

&lt;p&gt;Now that we have a mapped-listing of X.509 certificates and their chains mapped
to an alias, we can iterate over them to find by date:&lt;/p&gt;

&lt;div class=&#34;highlight&#34; style=&#34;background: #202020&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;private&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;X509Certificate&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #447fcf&#34;&gt;filterCertificates&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(List&amp;lt;X509Certificate&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs,&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;days_threshold)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;List&amp;lt;X509Certificate&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;filtered&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Lists.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;newArrayList&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(X509Certificate&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;cert&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;certs)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;DateTime&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;expiration_date&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;DateTime(cert.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getNotAfter&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;());&lt;/span&gt;
        &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;int&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;days_to_expiration&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;Days.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;daysBetween&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(DateTime.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;now&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(),&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;expiration_date.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;getDays&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;();&lt;/span&gt;
        &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;(days_to_expiration&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;days_threshold)&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d0d0d0&#34;&gt;filtered.&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;add&lt;/span&gt;&lt;span style=&#34;color: #d0d0d0&#34;&gt;(cert);&lt;/span&gt;
        &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #6ab825; font-weight: bold&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color: #d0d0d0&#34;&gt;filtered;&lt;/span&gt;
&lt;span style=&#34;color: #d0d0d0&#34;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here, we&amp;rsquo;re simply making use of the excellent &lt;a href=&#34;http://www.joda.org/joda-time/quickstart.html&#34;&gt;Joda DateTime&lt;/a&gt;
to parse the &lt;code&gt;java.util.Date&lt;/code&gt; object and compute the days between the curren
time and the expiration date.  I&amp;rsquo;d rather not worry about leap years, other
calendar types, etc., when computing things, so let&amp;rsquo;s just let a great library
do that for us.&lt;/p&gt;

&lt;h1 id=&#34;summary:ea83c6f13264b77e32b6387eb48f3ca8&#34;&gt;Summary&lt;/h1&gt;

&lt;p&gt;I hope this overview of how to parse and compute expiration dates on
certificates in your Keystore can be of some use.  It&amp;rsquo;s not hard, but half the
battle is figuring out &lt;strong&gt;what&lt;/strong&gt; you need to know before you do it.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>